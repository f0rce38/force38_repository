import logging
import requests
from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup
from telegram.ext import Application, CommandHandler, MessageHandler, CallbackQueryHandler, filters, ContextTypes

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    level=logging.INFO
)
logger = logging.getLogger(__name__)

# –í–∞—à —Ç–æ–∫–µ–Ω
BOT_TOKEN = "8488829489:AAFPtTIg2ni_yin5nofjNjsycyS7QVm0HsU"


class GameBot:
    def __init__(self):
        self.api_key = "c542e67aec3a4340908f9de9e86038af"
        self.api_url = "https://api.rawg.io/api/games"

        # –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∏–≥—Ä—ã –¥–ª—è –∫–Ω–æ–ø–æ–∫
        self.popular_games = [
            "Minecraft", "The Witcher 3", "GTA V", "Cyberpunk 2077",
            "Elden Ring", "Red Dead Redemption 2", "Counter-Strike 2",
            "Fortnite", "Valorant", "Dota 2", "League of Legends",
            "Baldur's Gate 3", "Hogwarts Legacy", "Call of Duty"
        ]

        # –î–µ–º–æ-–¥–∞–Ω–Ω—ã–µ
        self.demo_data = {
            'minecraft': {
                'name': 'Minecraft',
                'released': '2011',
                'rating': '4.5/5',
                'genres': '–ü–µ—Å–æ—á–Ω–∏—Ü–∞, –í—ã–∂–∏–≤–∞–Ω–∏–µ',
                'description': '–°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ –∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –≤ –±–ª–æ–∫–æ–≤–æ–º –º–∏—Ä–µ.'
            },
            'witcher': {
                'name': 'The Witcher 3: Wild Hunt',
                'released': '2015',
                'rating': '4.9/5',
                'genres': 'RPG, –§—ç–Ω—Ç–µ–∑–∏',
                'description': '–≠–ø–∏—á–µ—Å–∫–∞—è –∏—Å—Ç–æ—Ä–∏—è –≤–µ–¥—å–º–∞–∫–∞ –ì–µ—Ä–∞–ª—å—Ç–∞.'
            },
            'gta': {
                'name': 'Grand Theft Auto V',
                'released': '2013',
                'rating': '4.7/5',
                'genres': '–≠–∫—à–µ–Ω, –û—Ç–∫—Ä—ã—Ç—ã–π –º–∏—Ä',
                'description': '–ö—Ä–∏–º–∏–Ω–∞–ª—å–Ω–∞—è —Å–∞–≥–∞ –≤ –õ–æ—Å-–°–∞–Ω—Ç–æ—Å–µ.'
            },
            'cyberpunk': {
                'name': 'Cyberpunk 2077',
                'released': '2020',
                'rating': '4.0/5',
                'genres': 'RPG, –ö–∏–±–æ—Ä–≥–ø–∞–Ω–∫',
                'description': '–ü—Ä–∏–∫–ª—é—á–µ–Ω–∏—è –≤ —Ñ—É—Ç—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–æ–º –ù–∞–π—Ç-–°–∏—Ç–∏.'
            }
        }

    async def start(self, update: Update, context: ContextTypes.DEFAULT_TYPE):
        """–ö–æ–º–∞–Ω–¥–∞ /start —Å –∫–Ω–æ–ø–∫–∞–º–∏"""
        user = update.effective_user

        # –°–æ–∑–¥–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –∫–Ω–æ–ø–∫–∞–º–∏
        keyboard = [
            [InlineKeyboardButton("üéÆ –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∏–≥—Ä—ã", callback_data='popular')],
            [InlineKeyboardButton("üîç –ü–æ–∏—Å–∫ –∏–≥—Ä—ã", callback_data='search')],
            [InlineKeyboardButton("‚ÑπÔ∏è –ü–æ–º–æ—â—å", callback_data='help')],
            [
                InlineKeyboardButton("Minecraft", callback_data='game_minecraft'),
                InlineKeyboardButton("Witcher 3", callback_data='game_witcher')
            ],
            [
                InlineKeyboardButton("GTA V", callback_data='game_gta'),
                InlineKeyboardButton("Cyberpunk", callback_data='game_cyberpunk')
            ]
        ]
        reply_markup = InlineKeyboardMarkup(keyboard)

        await update.message.reply_text(
            f"üéÆ <b>–ü—Ä–∏–≤–µ—Ç, {user.first_name}!</b>\n\n"
            "–Ø - –±–æ—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –∏–≥—Ä–∞—Ö.\n\n"
            "–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ –∏–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–≥—Ä—ã:",
            reply_markup=reply_markup,
            parse_mode='HTML'
        )

    async def help_command(self, update: Update, context: ContextTypes.DEFAULT_TYPE):
        """–ö–æ–º–∞–Ω–¥–∞ /help"""
        keyboard = [
            [InlineKeyboardButton("üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='main_menu')],
            [InlineKeyboardButton("üéÆ –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∏–≥—Ä—ã", callback_data='popular')]
        ]
        reply_markup = InlineKeyboardMarkup(keyboard)

        await update.message.reply_text(
            "üìö <b>–°–ø—Ä–∞–≤–∫–∞:</b>\n\n"
            "üéÆ <b>–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:</b>\n"
            "1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –≤—ã–±–æ—Ä–∞\n"
            "2. –ò–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–≥—Ä—ã –≤ —á–∞—Ç\n\n"
            "‚öôÔ∏è <b>–ö–æ–º–∞–Ω–¥—ã:</b>\n"
            "/start - –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é\n"
            "/help - –≠—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞\n"
            "/search - –ü–æ–∏—Å–∫ –∏–≥—Ä—ã\n\n"
            "üì± <b>–ö–Ω–æ–ø–∫–∏:</b>\n"
            "‚Ä¢ –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∏–≥—Ä—ã - —Ç–æ–ø –∏–≥—Ä\n"
            "‚Ä¢ –ü–æ–∏—Å–∫ –∏–≥—Ä—ã - –≤–≤–µ—Å—Ç–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ\n"
            "‚Ä¢ –ö–Ω–æ–ø–∫–∏ —Å –∏–≥—Ä–∞–º–∏ - –±—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø",
            reply_markup=reply_markup,
            parse_mode='HTML'
        )

    async def search_command(self, update: Update, context: ContextTypes.DEFAULT_TYPE):
        """–ö–æ–º–∞–Ω–¥–∞ /search"""
        if not context.args:
            await update.message.reply_text(
                "üîç <b>–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–≥—Ä—ã –ø–æ—Å–ª–µ –∫–æ–º–∞–Ω–¥—ã:</b>\n"
                "–ü—Ä–∏–º–µ—Ä: /search Minecraft",
                parse_mode='HTML'
            )
            return

        game_name = ' '.join(context.args)
        await self.search_game(update, game_name)

    async def handle_message(self, update: Update, context: ContextTypes.DEFAULT_TYPE):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π"""
        # –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –∫–æ–º–∞–Ω–¥—ã
        if update.message.text.startswith('/'):
            return

        game_name = update.message.text
        await self.search_game(update, game_name)

    async def button_handler(self, update: Update, context: ContextTypes.DEFAULT_TYPE):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏–π –Ω–∞ –∫–Ω–æ–ø–∫–∏"""
        query = update.callback_query
        await query.answer()

        data = query.data

        if data == 'main_menu':
            await self.show_main_menu(query)
        elif data == 'popular':
            await self.show_popular_games(query)
        elif data == 'search':
            await query.edit_message_text(
                "üîç <b>–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–≥—Ä—ã:</b>\n\n"
                "–ü—Ä–∏–º–µ—Ä—ã:\n"
                "‚Ä¢ Minecraft\n"
                "‚Ä¢ The Witcher 3\n"
                "‚Ä¢ GTA V",
                parse_mode='HTML'
            )
        elif data == 'help':
            await self.show_help(query)
        elif data.startswith('game_'):
            game_key = data.split('_')[1]
            await self.show_game_info(query, game_key)
        elif data.startswith('select_'):
            game_name = data.split('_', 1)[1]
            await self.search_game_callback(query, game_name)

    async def show_main_menu(self, query):
        """–ü–æ–∫–∞–∑–∞—Ç—å –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é"""
        keyboard = [
            [InlineKeyboardButton("üéÆ –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∏–≥—Ä—ã", callback_data='popular')],
            [InlineKeyboardButton("üîç –ü–æ–∏—Å–∫ –∏–≥—Ä—ã", callback_data='search')],
            [InlineKeyboardButton("‚ÑπÔ∏è –ü–æ–º–æ—â—å", callback_data='help')],
            [
                InlineKeyboardButton("Minecraft", callback_data='game_minecraft'),
                InlineKeyboardButton("Witcher 3", callback_data='game_witcher')
            ],
            [
                InlineKeyboardButton("GTA V", callback_data='game_gta'),
                InlineKeyboardButton("Cyberpunk", callback_data='game_cyberpunk')
            ]
        ]
        reply_markup = InlineKeyboardMarkup(keyboard)

        await query.edit_message_text(
            "üè† <b>–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</b>\n\n"
            "–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ –∏–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–≥—Ä—ã:",
            reply_markup=reply_markup,
            parse_mode='HTML'
        )

    async def show_popular_games(self, query):
        """–ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∏–≥—Ä"""
        # –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫–∏ –¥–ª—è –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∏–≥—Ä (–ø–æ 2 –≤ —Å—Ç—Ä–æ–∫–µ)
        keyboard = []
        row = []
        for i, game in enumerate(self.popular_games[:12], 1):
            row.append(InlineKeyboardButton(game, callback_data=f'select_{game}'))
            if i % 2 == 0:
                keyboard.append(row)
                row = []
        if row:
            keyboard.append(row)

        keyboard.append([InlineKeyboardButton("üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='main_menu')])
        reply_markup = InlineKeyboardMarkup(keyboard)

        await query.edit_message_text(
            "üèÜ <b>–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∏–≥—Ä—ã:</b>\n\n"
            "–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä—É –∏–∑ —Å–ø–∏—Å–∫–∞:",
            reply_markup=reply_markup,
            parse_mode='HTML'
        )

    async def show_help(self, query):
        """–ü–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É"""
        keyboard = [
            [InlineKeyboardButton("üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='main_menu')],
            [InlineKeyboardButton("üéÆ –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∏–≥—Ä—ã", callback_data='popular')]
        ]
        reply_markup = InlineKeyboardMarkup(keyboard)

        await query.edit_message_text(
            "üìö <b>–°–ø—Ä–∞–≤–∫–∞:</b>\n\n"
            "üéÆ <b>–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:</b>\n"
            "1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –≤—ã–±–æ—Ä–∞\n"
            "2. –ò–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–≥—Ä—ã –≤ —á–∞—Ç\n\n"
            "‚öôÔ∏è <b>–ö–æ–º–∞–Ω–¥—ã:</b>\n"
            "/start - –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é\n"
            "/help - –≠—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞\n"
            "/search - –ü–æ–∏—Å–∫ –∏–≥—Ä—ã\n\n"
            "üì± <b>–ö–Ω–æ–ø–∫–∏:</b>\n"
            "‚Ä¢ –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∏–≥—Ä—ã - —Ç–æ–ø –∏–≥—Ä\n"
            "‚Ä¢ –ü–æ–∏—Å–∫ –∏–≥—Ä—ã - –≤–≤–µ—Å—Ç–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ\n"
            "‚Ä¢ –ö–Ω–æ–ø–∫–∏ —Å –∏–≥—Ä–∞–º–∏ - –±—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø",
            reply_markup=reply_markup,
            parse_mode='HTML'
        )

    async def show_game_info(self, query, game_key):
        """–ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∏–≥—Ä–µ –ø–æ –∫–ª—é—á—É"""
        if game_key in self.demo_data:
            game = self.demo_data[game_key]
            response = (
                f"üéÆ <b>{game['name']}</b>\n\n"
                f"üìÖ <b>–ì–æ–¥ –≤—ã—Ö–æ–¥–∞:</b> {game['released']}\n"
                f"‚≠ê <b>–†–µ–π—Ç–∏–Ω–≥:</b> {game['rating']}\n"
                f"üé≠ <b>–ñ–∞–Ω—Ä—ã:</b> {game['genres']}\n"
                f"üìù <b>–û–ø–∏—Å–∞–Ω–∏–µ:</b> {game['description']}"
            )
        else:
            response = "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∏–≥—Ä–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞."

        keyboard = [
            [InlineKeyboardButton("üîç –ü–æ–∏—Å–∫ –¥—Ä—É–≥–æ–π –∏–≥—Ä—ã", callback_data='search')],
            [InlineKeyboardButton("üéÆ –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∏–≥—Ä—ã", callback_data='popular')],
            [InlineKeyboardButton("üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='main_menu')]
        ]
        reply_markup = InlineKeyboardMarkup(keyboard)

        await query.edit_message_text(
            response,
            reply_markup=reply_markup,
            parse_mode='HTML'
        )

    async def search_game_callback(self, query, game_name):
        """–ü–æ–∏—Å–∫ –∏–≥—Ä—ã –∏–∑ callback"""
        await query.edit_message_text(f"üîç –ò—â—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∏–≥—Ä–µ: <b>{game_name}</b>...", parse_mode='HTML')

        # –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ API
        api_data = await self.get_api_game_info(game_name)

        if api_data:
            response = self.format_api_response(api_data)
        else:
            # –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ
            response = self.get_demo_response(game_name)

        keyboard = [
            [InlineKeyboardButton("üéÆ –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∏–≥—Ä—ã", callback_data='popular')],
            [InlineKeyboardButton("üîç –ù–æ–≤—ã–π –ø–æ–∏—Å–∫", callback_data='search')],
            [InlineKeyboardButton("üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='main_menu')]
        ]
        reply_markup = InlineKeyboardMarkup(keyboard)

        await query.edit_message_text(
            response,
            reply_markup=reply_markup,
            parse_mode='HTML'
        )

    async def search_game(self, update, game_name):
        """–û—Å–Ω–æ–≤–Ω–æ–π –ø–æ–∏—Å–∫ –∏–≥—Ä—ã"""
        if hasattr(update, 'message'):
            await update.message.reply_text(f"üîç –ò—â—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∏–≥—Ä–µ: <b>{game_name}</b>...", parse_mode='HTML')
            message_func = update.message.reply_text
        else:
            await update.edit_message_text(f"üîç –ò—â—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∏–≥—Ä–µ: <b>{game_name}</b>...", parse_mode='HTML')
            message_func = update.edit_message_text

        # –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ API
        api_data = await self.get_api_game_info(game_name)

        if api_data:
            response = self.format_api_response(api_data)
        else:
            # –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ
            response = self.get_demo_response(game_name)

        keyboard = [
            [InlineKeyboardButton("üéÆ –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∏–≥—Ä—ã", callback_data='popular')],
            [InlineKeyboardButton("üîç –ù–æ–≤—ã–π –ø–æ–∏—Å–∫", callback_data='search')],
            [InlineKeyboardButton("üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='main_menu')]
        ]
        reply_markup = InlineKeyboardMarkup(keyboard)

        await message_func(
            response,
            reply_markup=reply_markup,
            parse_mode='HTML'
        )

    async def get_api_game_info(self, game_name: str):
        """–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ API"""
        try:
            params = {
                'key': self.api_key,
                'search': game_name,
                'page_size': 1
            }

            response = requests.get(self.api_url, params=params, timeout=5)

            if response.status_code == 200:
                data = response.json()
                if data['results']:
                    return data['results'][0]

            return None

        except Exception as e:
            logger.debug(f"API error: {e}")
            return None

    def format_api_response(self, game_data: dict) -> str:
        """–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ –∏–∑ API"""
        name = game_data.get('name', '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ')
        released = game_data.get('released', '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ')
        rating = game_data.get('rating', '–ù/–î')

        # –ñ–∞–Ω—Ä—ã
        genres = ', '.join([g['name'] for g in game_data.get('genres', [])[:3]]) or '–ù–µ —É–∫–∞–∑–∞–Ω—ã'

        # –ü–ª–∞—Ç—Ñ–æ—Ä–º—ã
        platforms = ', '.join([p['platform']['name'] for p in game_data.get('platforms', [])[:3]]) or '–ù–µ —É–∫–∞–∑–∞–Ω—ã'

        # –û–ø–∏—Å–∞–Ω–∏–µ
        description = game_data.get('description_raw', '')[:200]
        if len(description) > 200:
            description = description[:200] + '...'

        response = (
            f"üéÆ <b>{name}</b>\n\n"
            f"üìÖ <b>–î–∞—Ç–∞ –≤—ã—Ö–æ–¥–∞:</b> {released}\n"
            f"‚≠ê <b>–†–µ–π—Ç–∏–Ω–≥:</b> {rating}/5\n"
            f"üé≠ <b>–ñ–∞–Ω—Ä—ã:</b> {genres}\n"
            f"üñ•Ô∏è <b>–ü–ª–∞—Ç—Ñ–æ—Ä–º—ã:</b> {platforms}\n"
        )

        if description:
            response += f"\nüìù <b>–û–ø–∏—Å–∞–Ω–∏–µ:</b>\n{description}"

        return response

    def get_demo_response(self, game_name: str) -> str:
        """–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–µ–º–æ-–æ—Ç–≤–µ—Ç–∞"""
        game_name_lower = game_name.lower()

        # –ò—â–µ–º –≤ –¥–µ–º–æ-–¥–∞–Ω–Ω—ã—Ö
        for key, game_info in self.demo_data.items():
            if key in game_name_lower:
                return (
                    f"üéÆ <b>{game_info['name']}</b>\n\n"
                    f"üìÖ <b>–ì–æ–¥ –≤—ã—Ö–æ–¥–∞:</b> {game_info['released']}\n"
                    f"‚≠ê <b>–†–µ–π—Ç–∏–Ω–≥:</b> {game_info['rating']}\n"
                    f"üé≠ <b>–ñ–∞–Ω—Ä—ã:</b> {game_info['genres']}\n"
                    f"üìù <b>–û–ø–∏—Å–∞–Ω–∏–µ:</b> {game_info['description']}\n\n"
                    f"<i>‚ÑπÔ∏è –î–µ–º–æ-–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è. –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–∏—Ç–µ API.</i>"
                )

        # –ï—Å–ª–∏ –∏–≥—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞
        return (
            f"üîç <b>{game_name}</b>\n\n"
            "–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, —è –Ω–µ –Ω–∞—à–µ–ª –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± —ç—Ç–æ–π –∏–≥—Ä–µ.\n\n"
            "üéÆ <b>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ:</b>\n"
            "‚Ä¢ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–Ω–æ–ø–∫–∏ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∏–≥—Ä\n"
            "‚Ä¢ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –Ω–∞–∑–≤–∞–Ω–∏—è\n"
            "‚Ä¢ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∞–Ω–≥–ª–∏–π—Å–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ"
        )


def main():
    """–ó–∞–ø—É—Å–∫ –±–æ—Ç–∞"""
    print("=" * 50)
    print("ü§ñ –ó–ê–ü–£–°–ö GAME BOT –° –ö–ù–û–ü–ö–ê–ú–ò")
    print(f"üì± –¢–æ–∫–µ–Ω: {BOT_TOKEN[:10]}...")
    print("=" * 50)

    try:
        # –°–æ–∑–¥–∞–µ–º –±–æ—Ç–∞
        bot = GameBot()

        # –°–æ–∑–¥–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
        app = Application.builder().token(BOT_TOKEN).build()

        # –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
        app.add_handler(CommandHandler("start", bot.start))
        app.add_handler(CommandHandler("help", bot.help_command))
        app.add_handler(CommandHandler("search", bot.search_command))

        # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–æ–∫
        app.add_handler(CallbackQueryHandler(bot.button_handler))

        # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
        app.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, bot.handle_message))

        # –ó–∞–ø—É—Å–∫–∞–µ–º
        print("\n‚úÖ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω!")
        print("üì± –ù–∞–π–¥–∏—Ç–µ –±–æ—Ç–∞ –≤ Telegram –∏ –Ω–∞–∂–º–∏—Ç–µ /start")
        print("üéÆ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞")
        print("‚è∏Ô∏è  Ctrl+C –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏")
        print("=" * 50)

        app.run_polling()

    except Exception as e:
        print(f"\n‚ùå –û—à–∏–±–∫–∞: {e}")
        print("\nüîß –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:")
        print("1. –ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å —Ç–æ–∫–µ–Ω–∞")
        print("2. –ù–∞–ª–∏—á–∏–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞")
        print("3. –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –ª–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏:")
        print("   pip install python-telegram-bot requests")


if __name__ == "__main__":
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
    try:
        import telegram
        import requests
    except ImportError:
        print("–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: pip install python-telegram-bot requests")
        exit(1)

    main()
